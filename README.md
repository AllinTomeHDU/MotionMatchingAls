第一次实习接触到的项目是关于ALS的，对ALS的第一印象是复杂，像一座难以跨越的大山，通过代码逻辑结合动画曲线，以实现最终丝滑的效果。 

实习经历并不轻松，基于ALS的功能扩充我往往不能做出理想的最终效果，原因之一是我当时对于UE开发的经验不足，原因之二可能是这套系统本来就难以做二次开发，最棘手的问题就是多种曲线与逻辑控制相关（动画曲线、混合曲线、数据曲线），所有添加的动画资产都要设置并检查其曲线值，曲线值影响最终姿势的混合结果，如果不能理清所有曲线的使用，将很难为系统添加新的动画状态机节点。

为了加深我自身对于角色运动逻辑控制的理解，我耐心研究ALS的设计思路并动手复刻，也看了不少相关文章，以下是我个人对其的看法：

- 以尽可能少的动画资产去实现丰富的动画效果是其特点，分层叠加混合去实现多姿势输出也是非常优秀的设计，但是通过StateMachine对多姿势的直接引用内存开销大；
- 八向运动、步态/姿态/行停/地空的过渡、脚部IK与锁定、原地旋转、瞄准偏移、Ragdoll，这些功能的实现都是教科书级别的设计思路，即便如今UE5已经将这些部分功能封装成了可简单调用的节点，我们依然可以参考ALS去实现；
- 通过曲线控制叠加，曲线配置与维护成本高，叠加混合难以展现角色动作风格化，倒是适合于不同角色动作趋于一致的射击类游戏。

毋庸置疑ALS是来自天才的构思，作者对于细节处的打磨令人惊叹，但其缺陷也是我们不容忽视的问题，于是我再去研究了ALS的Community和Refactored版本。

- Community版本将蓝图版本改为C++实现，将项目封装成独立插件，增添了网络同步，代码结构与功能实现与原项目完全一致，仅仅是通过C++提高性能。
- Refactored版本通过C++对项目结构进行重新设计，更加模块化，以及对性能进行优化（线程安全、多动画蓝图的动态Link），同样也是独立插件，支持网络同步，该版本在原项目基础上做了部分功能的优化（最明显的是对于摄像机系统的实现是更加优秀的，有更平滑的过渡），但是其源代码相对于原项目也复杂很多。



GASP是UE5.4推出的示例项目，其核心技术是MotionMatching，在UE后续的5.5和5.6版本也持续对这个项目进行了更新。正是遗憾于ALS存在的问题，驱动着我深入研究GASP。

GASP使用了一些实验性的蓝图节点，比如Steering、OffsetRootBone、FootPlacement，这些节点简化了开发流程，但是也存在一些bug，比如为了让运动匹配的动作更加流畅而添加的根骨骼偏移，容易在贴墙运动时产生穿模现象，目前通过逻辑控制也只能缓解而非杜绝这种现象，FootPlacement的脚部锁定在八向运动的枢轴运动（快速转向）时容易引发交叉腿问题，虽然交叉腿问题本身就是一个容易在防滑步锁脚时引发的bug且难以杜绝。

本项目原本是计划设计为独立插件的，但是我觉得对于场景中TraversalActor的检测使用单独的TraceChannel更好，于是便将插件依附于空的项目，空项目仅仅添加了Traversal这个TraceChannel设置。

GASP除了官方提供的蓝图项目，还有其他开发者分享的版本，比如GASP_ALS：蓝图实现，增添了Overlay、HandIK、Ragdoll的功能，也有参考了ALS-Refactored的C++实现的重构版本，这两个项目的链接如下：

- https://github.com/PolygonHive/GASP-ALS
- https://github.com/Anaylan/GASP-Refactored

链接中的两个项目也是作为了本项目的参考，经过权衡，本项目最终决定采用的技术架构为：

1. 运动姿势：通过MotionMatching进行选择，通过ChooserTable做数据库的分类选择（步态/姿态/地空）；
2. 旋转模式：通过OffsetRootBone、Steering控制角色朝向，以及原地转向、瞄准的功能；
3. 脚部IK与锁定：通过FootPlacement与LegIK实现，若开启此功能会偶然性触发交叉腿现象；
4. Overlay：采用曲线控制的分层混合输出上半身多姿势，以及曲线控制HandIK，通过AnimLayerInterface动态链接；
5. Traversal：与Main动画蓝图解耦，通过蒙太奇播放单独动画，或通过子动画蓝图的动态链接输出姿势；
6. Ragdoll：参考ALS-Community的实现，并做好位置上的网络同步，修改PhysicsAsset的物理约束；
7. Camera：参考ALS-Refactored的实现，CameraComponent作为骨骼网格体附加值角色网格上，通过动画蓝图进行平滑过渡；
8. 音效系统：通过Interface的方式去获取并播放MetaSounds数据资产；
9. Debug：独立的DebugComponent能支持对联机模式下本地多角色的数据监控，可以根据需要自行修改源码添加需要监控的数据。















